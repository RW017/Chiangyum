<!-- HTML part -->
<form id="uploadForm" action="/upload" enctype="multipart/form-data">
    <input type="file" id="fileInput" onchange="readURL(this)" targetID="preview_progressbarTW_img" accept="image/gif, image/jpeg, image/png" />
    <button id="deleteBtn" style="display:none;" onclick="removeImage(); return false;">刪除</button>
    <img id="preview_progressbarTW_img" src="#" style="display:none;" />
</form>

<!-- JavaScript part -->
<script src="img.js"></script>
<script src="server.js"></script>
<script>
function readURL(input) {
    if(input.files && input.files[0]) {
        var imageTagID = input.getAttribute("targetID");

        var reader = new FileReader();

        reader.onload = function (e) {
            var img = document.getElementById(imageTagID);
            img.setAttribute("src", e.target.result);
            img.style.display = "block"; // show the image element
        }

        reader.readAsDataURL(input.files[0]);

        // Show the delete button
        document.getElementById('deleteBtn').style.display = "inline";
        
        // Change the file input to delete button
        document.getElementById('fileInput').style.display = "none";
    }
}

function removeImage() {
    // Remove image source and hide the image element
    var img = document.getElementById('preview_progressbarTW_img');
    img.setAttribute("src", "#");
    img.style.display = "none";

    // Clear file input value
    var fileInput = document.getElementById('fileInput');
    fileInput.value = "";
    fileInput.style.display = "inline";

    // Hide delete button
    document.getElementById('deleteBtn').style.display = "none";
}
</script>
